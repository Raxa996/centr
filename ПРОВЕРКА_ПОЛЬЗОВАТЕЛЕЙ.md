# Проверка существующих пользователей в Supabase

## Шаг 1: Проверьте существующих пользователей

Выполните в SQL редакторе Supabase:

```sql
-- Проверяем пользователей в auth.users
SELECT 
    id,
    email,
    email_confirmed_at,
    created_at
FROM auth.users
ORDER BY created_at;

-- Проверяем пользователей в таблице users
SELECT 
    u.id,
    u.full_name,
    u.role_id,
    u.phone,
    r.title as role_title
FROM users u
LEFT JOIN roles r ON r.id = u.role_id
ORDER BY u.created_at;
```

## Шаг 2: Создайте тестовых пользователей

Если пользователей нет, выполните скрипт `create-users-for-existing-project.sql`

## Шаг 3: Обновите код авторизации

Если у вас уже есть пользователи с другими email адресами, обновите код в `script.js`:

### Для родителей:
Замените в функции `handleLogin`:
```javascript
// Вместо:
emailForAuth = `parent_${cleanPhone}@test.kz`;

// Используйте существующий email:
emailForAuth = 'ваш_существующий_email@domain.com';
```

### Для персонала:
Замените в функции `handleStaffLogin`:
```javascript
// Используйте существующие email адреса:
// owner@test.kz -> ваш_owner_email@domain.com
// admin@test.kz -> ваш_admin_email@domain.com
// teacher@test.kz -> ваш_teacher_email@domain.com
```

## Шаг 4: Проверьте роли

Убедитесь, что в таблице `roles` есть нужные роли:
```sql
SELECT * FROM roles;
```

Если ролей нет, создайте их:
```sql
INSERT INTO roles(id, title) VALUES
('owner','Владелец'),
('admin','Администратор'),
('teacher','Преподаватель'),
('parent','Родитель')
ON CONFLICT (id) DO UPDATE SET title = excluded.title;
```

## Шаг 5: Тестирование

1. Откройте `index.html`
2. Нажмите "Войти"
3. Выберите нужную вкладку
4. Введите существующие email и пароль
5. Проверьте, что происходит редирект в нужный кабинет

## Возможные проблемы:

1. **"Invalid login credentials"** - проверьте email и пароль
2. **"User not found"** - пользователь не создан в таблице `users`
3. **"Role not found"** - роль не назначена пользователю
4. **"RLS policy"** - проблемы с правами доступа

## Отладка:

Добавьте в консоль браузера:
```javascript
console.log('Current user:', currentUser);
console.log('User role:', currentUser?.role);
```
