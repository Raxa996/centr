# Отладка авторизации - Нет перехода на кабинеты

## Проблема
После успешного входа в систему не происходит переход на страницы кабинетов.

## Решение

### 1. Проверьте консоль браузера
1. Откройте `index.html`
2. Нажмите F12 (Developer Tools)
3. Перейдите на вкладку "Console"
4. Попробуйте войти в систему
5. Посмотрите на сообщения в консоли

### 2. Используйте тестовую страницу
1. Откройте `test-auth.html`
2. Введите данные для входа
3. Нажмите "Тест входа"
4. Посмотрите на лог сообщений

### 3. Проверьте пользователей в базе данных
Выполните в SQL редакторе Supabase:
```sql
-- Проверяем пользователей
SELECT 
    u.id,
    u.full_name,
    u.role_id,
    au.email
FROM users u
JOIN auth.users au ON au.id = u.id
WHERE au.email LIKE '%test%' OR au.email LIKE '%owner%' OR au.email LIKE '%admin%';
```

### 4. Создайте тестового пользователя
Если пользователей нет, выполните:
```sql
-- Создаем тестового пользователя
INSERT INTO auth.users (
    id, instance_id, aud, role, email, encrypted_password,
    email_confirmed_at, raw_app_meta_data, raw_user_meta_data,
    created_at, updated_at, confirmation_token, email_change,
    email_change_token_new, recovery_token
) VALUES (
    gen_random_uuid(),
    '00000000-0000-0000-0000-000000000000',
    'authenticated',
    'authenticated',
    'test@test.kz',
    crypt('test123', gen_salt('bf')),
    NOW(),
    '{"provider":"email","providers":["email"]}',
    '{}',
    NOW(),
    NOW(),
    '', '', '', ''
) ON CONFLICT (email) DO NOTHING;

-- Добавляем в таблицу users
INSERT INTO users (id, full_name, role_id, phone)
SELECT 
    au.id,
    'Тестовый пользователь',
    'admin',
    '+7 777 000 00 00'
FROM auth.users au 
WHERE au.email = 'test@test.kz'
ON CONFLICT (id) DO UPDATE SET 
    full_name = EXCLUDED.full_name,
    role_id = EXCLUDED.role_id,
    phone = EXCLUDED.phone;
```

## Возможные причины проблемы

### 1. Пользователь не найден в таблице users
**Симптом:** Ошибка "Error getting user role"
**Решение:** Создайте пользователя в таблице users

### 2. Неправильная роль
**Симптом:** Роль null или undefined
**Решение:** Проверьте поле role_id в таблице users

### 3. Проблемы с путями
**Симптом:** Страница не найдена (404)
**Решение:** Используйте относительные пути (уже исправлено)

### 4. Проблемы с RLS
**Симптом:** Ошибки доступа к данным
**Решение:** Проверьте RLS политики

## Тестовые данные для входа

### Быстрый тест:
- **Email:** `test@test.kz`
- **Пароль:** `test123`
- **Роль:** `admin`
- **Ожидаемый редирект:** `admin-dashboard.html`

## Отладочные сообщения

В консоли должны появиться сообщения:
```
Login successful, user data: {id: "...", email: "...", role: "admin", name: "..."}
Getting user role for: test@test.kz
User role: admin
Redirecting to admin dashboard
```

Если этих сообщений нет, значит проблема в авторизации.
Если сообщения есть, но редиректа нет, значит проблема в путях или файлах.

## Проверка файлов кабинетов

Убедитесь, что файлы существуют:
- `owner-dashboard.html`
- `admin-dashboard.html`
- `crm-dashboard.html`
- `parent-dashboard.html`

## Альтернативное решение

Если ничего не помогает, добавьте в консоль браузера:
```javascript
// Принудительный переход
window.location.href = 'admin-dashboard.html';
```
